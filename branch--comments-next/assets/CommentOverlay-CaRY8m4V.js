import{i as y,l as $,f as L,s as N,o as z,t as D,a as S}from"./index-AHG6cjRE.js";import"./vendor-primer-BK6UB-si.js";import"./vendor-react-BQyrhFMj.js";import"./vendor-octicons-BtAiKi0j.js";import"./vendor-reshaped-BDP14DwY.js";function T(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}let a=null;async function M(){if(!y())return;if(a){d();return}const t=document.createElement("div");t.className="sb-comments-drawer-backdrop fixed top-0 right-0 bottom-0 left-0",t.style.cssText="z-index:99997;background:rgba(0,0,0,0.4)",t.addEventListener("click",d);const i=document.createElement("div");i.className="sb-comments-drawer sb-drawer-animate fixed top-0 right-0 bottom-0 flex flex-column sb-bg bl sb-b-default sb-shadow sans-serif",i.style.cssText="z-index:99998;width:420px;max-width:90vw";const p=document.createElement("div");p.className="flex items-center justify-between ph4 pv3 bb sb-b-muted flex-shrink-0";const b=document.createElement("h2");b.className="f5 fw6 sb-fg ma0",b.textContent="All Comments",p.appendChild(b);const c=document.createElement("button");c.className="flex items-center justify-center bg-transparent bn br2 sb-fg-muted pointer",c.style.cssText="width:28px;height:28px;font-size:18px;line-height:1",c.innerHTML="Ã—",c.setAttribute("aria-label","Close"),c.addEventListener("click",d),p.appendChild(c),i.appendChild(p);const s=document.createElement("div");s.className="flex-auto overflow-y-auto pa0";const u=document.createElement("div");u.className="pv4 ph4 tc sb-fg-muted",u.style.fontSize="13px",u.textContent="Loading commentsâ€¦",s.appendChild(u),i.appendChild(s),document.body.appendChild(t),document.body.appendChild(i),a={backdrop:t,drawer:i};function w(o){o.key==="Escape"&&(o.preventDefault(),o.stopPropagation(),d(),window.removeEventListener("keydown",w,!0))}window.addEventListener("keydown",w,!0),a.onKeyDown=w;try{const o=await $();if(s.innerHTML="",!o||o.length===0){const e=document.createElement("div");e.className="pv4 ph4 tc sb-fg-muted",e.style.fontSize="13px",e.textContent="No comments yet",s.appendChild(e);return}for(const e of o){const v=e.title?.match(/^Comments:\s*(.+)$/);if(!v)continue;const f=v[1];let r;try{r=await L(f)}catch{continue}if(!r?.comments?.length)continue;const h=document.createElement("div");h.className="bb sb-b-muted";const g=document.createElement("div");g.className="flex items-center ph4 pv2 sb-bg-inset f7 fw6 sb-fg-muted",g.innerHTML=`<span class="code sb-fg-accent">${f}</span><span class="ml-auto fw4 flex flex-nowrap" style="font-size:11px;min-width:max-content">${r.comments.length} comment${r.comments.length!==1?"s":""}</span>`,h.appendChild(g);for(const n of r.comments){const m=document.createElement("button");m.className="flex ph4 pv2 pointer bn bg-transparent w-100 tl sans-serif",m.style.cssText="font:inherit;transition:background 100ms";const C=n.author?.avatarUrl?`<img class="br-100 ba sb-b-default flex-shrink-0 mr2" style="width:24px;height:24px" src="${n.author.avatarUrl}" alt="${n.author?.login??""}" />`:"",E=n.meta?.resolved?'<span class="sb-fg-success br-pill ph1" style="font-size:10px;background:color-mix(in srgb, var(--sb-fg-success) 10%, transparent)">Resolved</span>':"",x=n.replies?.length??0,k=x>0?`<div class="sb-fg-muted mt1" style="font-size:11px">ðŸ’¬ ${x} ${x===1?"reply":"replies"}</div>`:"";m.innerHTML=`
          ${C}
          <div class="flex-auto" style="min-width:0">
            <div class="flex items-center mb1">
              <span class="f7 fw6 sb-fg mr1">${n.author?.login??"unknown"}</span>
              ${n.createdAt?`<span class="sb-fg-muted mr1" style="font-size:11px">${T(n.createdAt)}</span>`:""}
              ${E}
            </div>
            <p class="sb-fg ma0 overflow-hidden nowrap truncate lh-copy" style="font-size:13px;text-overflow:ellipsis">${n.text?.slice(0,100)??""}</p>
            ${k}
          </div>
        `,m.addEventListener("click",()=>{if(d(),window.location.pathname!==f){const l=new URL(window.location.href);l.pathname=f,l.searchParams.set("comment",n.id),window.location.href=l.toString()}else{const l=new URL(window.location.href);l.searchParams.set("comment",n.id),window.history.replaceState(null,"",l.toString()),N(!0)}}),h.appendChild(m)}s.appendChild(h)}if(s.children.length===0){const e=document.createElement("div");e.className="pv4 ph4 tc sb-fg-muted",e.style.fontSize="13px",e.textContent="No comments yet",s.appendChild(e)}}catch(o){s.innerHTML="";const e=document.createElement("div");e.className="pv4 ph4 tc sb-fg-muted",e.style.fontSize="13px",e.textContent=`Failed to load comments: ${o.message}`,s.appendChild(e)}}function d(){a&&(a.onKeyDown&&window.removeEventListener("keydown",a.onKeyDown,!0),a.backdrop.remove(),a.drawer.remove(),a=null)}function P(){const t=[];return y()?(t.push({label:"Toggle comments",icon:"ðŸ’¬",onClick:()=>{D()}}),t.push({label:"See all comments",icon:"ðŸ“‹",onClick:()=>{M()}}),t.push({label:"Sign out of comments",icon:"ðŸšª",onClick:()=>{S()}})):t.push({label:"Sign in for comments",icon:"ðŸ’¬",onClick:()=>{z()}}),t}export{P as getCommentsMenuItems};
