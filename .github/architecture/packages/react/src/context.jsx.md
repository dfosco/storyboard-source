# `packages/react/src/context.jsx`

<!--
source: packages/react/src/context.jsx
category: storyboard
importance: high
-->

> [← Architecture Index](../../../../architecture.index.md)

## Goal

The `StoryboardProvider` component is the top-level data provider for the storyboard system in React. It loads scene data into React context, making it available to all child components via hooks like `useSceneData`, `useOverride`, and `useRecord`. It handles scene name resolution (from `?scene=` URL param, prop, page-matching, or default), record data merging for dynamic routes, and error display.

This component is the bridge between the framework-agnostic core ([`packages/core/src/loader.js`](../../core/src/loader.js.md)) and the React rendering tree.

## Composition

```js
export default function StoryboardProvider({ sceneName, recordName, recordParam, children }) {
  const pageScene = getPageSceneName()
  const activeSceneName = getSceneParam() || sceneName || (sceneExists(pageScene) ? pageScene : 'default')
  const params = useParams()

  const { data, error } = useMemo(() => {
    let sceneData = loadScene(activeSceneName)
    if (recordName && recordParam && params[recordParam]) {
      const entry = findRecord(recordName, params[recordParam])
      if (entry) sceneData = deepMerge(sceneData, { record: entry })
    }
    return { data: sceneData, error: null }
  }, [activeSceneName, recordName, recordParam, params])
  // ...
}
```

Internal helpers:
- `getSceneParam()` — Reads `?scene=` from `window.location` (avoids `useSearchParams` re-render issue)
- `getPageSceneName()` — Derives scene name from pathname (`/Overview` → `"Overview"`, `/` → `"index"`)

Scene resolution priority: `?scene=` param → `sceneName` prop → page-matching scene → `"default"`

Side-effect import: `virtual:storyboard-data-index` seeds the core data index via `init()`.

On error, renders an inline error message instead of children.

## Dependencies

- [`packages/core/src/loader.js`](../../core/src/loader.js.md) — `loadScene`, `sceneExists`, `findRecord`, `deepMerge`
- [`packages/react/src/StoryboardContext.js`](./StoryboardContext.js.md) — React context object
- `virtual:storyboard-data-index` — Generated by [`packages/react/src/vite/data-plugin.js`](./vite/data-plugin.js.md)
- `react-router-dom` — `useParams` for dynamic route params

## Dependents

- [`packages/react/src/index.js`](./index.js.md) — Re-exports as `StoryboardProvider`
- [`src/pages/_app.jsx`](../../../src/pages/_app.jsx.md) — Wraps the entire app

## Notes

- Uses `window.location.search` instead of `useSearchParams()` to avoid re-renders on router navigation events.
- The `pageScene` auto-matching allows pages to have matching scene files without explicit configuration.
